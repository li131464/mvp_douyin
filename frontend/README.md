# æŠ–éŸ³å°ç¨‹åºçœŸå®æ•°æ®è·å–ç³»ç»Ÿ

## é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºæŠ–éŸ³å¼€æ”¾å¹³å°APIçš„å®Œæ•´è§£å†³æ–¹æ¡ˆï¼ŒåŒ…å«å°ç¨‹åºå‰ç«¯å’ŒNode.jsåç«¯ï¼Œå®ç°äº†çœŸå®çš„ç”¨æˆ·æ•°æ®è·å–åŠŸèƒ½ï¼š

### åŠŸèƒ½ç‰¹æ€§
- âœ… ç”¨æˆ·è§†é¢‘åˆ—è¡¨è·å–
- âœ… ç”¨æˆ·è¯„è®ºæ•°æ®è·å–  
- âœ… ç”¨æˆ·ç§ä¿¡æ¶ˆæ¯è·å–
- âœ… å®Œæ•´çš„OAuthæˆæƒæµç¨‹
- âœ… åç«¯APIæœåŠ¡
- âœ… æ•°æ®ç¼“å­˜å’Œç®¡ç†
- âœ… é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

## é‡è¦è¯´æ˜

âœ… **å®Œæ•´çš„ç”Ÿäº§çº§è§£å†³æ–¹æ¡ˆ**

æœ¬é¡¹ç›®æä¾›äº†å®Œæ•´çš„å‰åç«¯å®ç°ï¼š

### å·²å®ç°åŠŸèƒ½
- ğŸ¯ **åç«¯APIæœåŠ¡** - å®Œæ•´çš„Node.jsæœåŠ¡ç«¯
- ğŸ” **OAuthæˆæƒæµç¨‹** - æ ‡å‡†çš„æŠ–éŸ³OAuthå®ç°
- ğŸ“Š **æ•°æ®è·å–æ¥å£** - è§†é¢‘ã€è¯„è®ºã€ç§ä¿¡API
- ğŸ›¡ï¸ **å®‰å…¨ç‰¹æ€§** - ä»¤ç‰Œç®¡ç†ã€é€Ÿç‡é™åˆ¶ã€CORSä¿æŠ¤
- ğŸ“ **å®Œæ•´æ–‡æ¡£** - éƒ¨ç½²æŒ‡å—å’ŒAPIæ–‡æ¡£

### æ¨¡æ‹Ÿæ¨¡å¼
- å½“æœªé…ç½®æŠ–éŸ³å¼€æ”¾å¹³å°å‡­è¯æ—¶ï¼Œè‡ªåŠ¨ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
- æ•°æ®ç»“æ„å®Œå…¨ç¬¦åˆæŠ–éŸ³å¼€æ”¾å¹³å°APIè§„èŒƒ
- ä¾¿äºå¼€å‘æµ‹è¯•å’Œæ¼”ç¤º

## æŠ€æœ¯æ¶æ„

### å‰ç«¯ï¼ˆå°ç¨‹åºï¼‰
- ğŸ¨ æŠ–éŸ³å°ç¨‹åºæ¡†æ¶
- ğŸ” OAuthæˆæƒæµç¨‹å®ç°
- ğŸ“± ç°ä»£åŒ–UIè®¾è®¡
- ğŸ”„ æ•°æ®åˆ†é¡µå’Œåˆ·æ–°
- ğŸ“Š æ•°æ®å±•ç¤ºå’Œäº¤äº’

### åç«¯ï¼ˆNode.js APIæœåŠ¡ï¼‰
- ğŸš€ Express.jsæ¡†æ¶
- ğŸ”’ JWTä»¤ç‰Œç®¡ç†
- ğŸ’¾ å†…å­˜ç¼“å­˜ç³»ç»Ÿ
- ğŸ“ Winstonæ—¥å¿—è®°å½•
- ğŸ›¡ï¸ å®‰å…¨ä¸­é—´ä»¶
- ğŸŒ CORSè·¨åŸŸæ”¯æŒ
- âš¡ é€Ÿç‡é™åˆ¶ä¿æŠ¤

### é¡¹ç›®ç»“æ„
```
æŠ–éŸ³æ•°æ®è·å–ç³»ç»Ÿ/
â”œâ”€â”€ ğŸ“± å‰ç«¯å°ç¨‹åº/
â”‚   â”œâ”€â”€ pages/          # é¡µé¢æ–‡ä»¶
â”‚   â”œâ”€â”€ utils/          # å·¥å…·ç±»
â”‚   â””â”€â”€ app.js          # åº”ç”¨å…¥å£
â””â”€â”€ ğŸ–¥ï¸ backend/         # åç«¯æœåŠ¡
    â”œâ”€â”€ routes/         # APIè·¯ç”±
    â”œâ”€â”€ utils/          # å·¥å…·ç±»
    â”œâ”€â”€ middleware/     # ä¸­é—´ä»¶
    â””â”€â”€ app.js          # æœåŠ¡å…¥å£
```

## æ ¸å¿ƒåŠŸèƒ½

### 1. ç™»å½•æˆæƒ
```javascript
// åŸºç¡€ç™»å½•
const loginResult = await douyinAuth.login();

// OAuthæˆæƒ
const authResult = await douyinAuth.authorizeWithScopes([
  'user_info',
  'video.list',
  'comment.list', 
  'message.list'
]);
```

### 2. æ•°æ®è·å–
```javascript
// è·å–ç”¨æˆ·è§†é¢‘
const videos = await douyinAuth.getUserVideos(cursor, count);

// è·å–ç”¨æˆ·è¯„è®º
const comments = await douyinAuth.getUserComments(cursor, count);

// è·å–ç”¨æˆ·ç§ä¿¡
const messages = await douyinAuth.getUserMessages(cursor, count);
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç«¯å°ç¨‹åº

1. **å¯¼å…¥é¡¹ç›®**
   ```bash
   # ä½¿ç”¨æŠ–éŸ³å¼€å‘è€…å·¥å…·æ‰“å¼€é¡¹ç›®æ ¹ç›®å½•
   # é…ç½®AppIDï¼ˆåœ¨æŠ–éŸ³å¼€æ”¾å¹³å°è·å–ï¼‰
   ```

2. **è¿è¡Œè°ƒè¯•**
   - ç‚¹å‡»é¢„è§ˆæˆ–çœŸæœºè°ƒè¯•
   - æµ‹è¯•ç™»å½•å’Œæ•°æ®è·å–åŠŸèƒ½

### åç«¯APIæœåŠ¡

1. **å®‰è£…å¯åŠ¨**
   ```bash
   cd backend
   npm install
   npm start
   ```

2. **æœåŠ¡éªŒè¯**
   ```bash
   # æ£€æŸ¥æœåŠ¡çŠ¶æ€
   curl http://localhost:3000/health
   
   # é¢„æœŸå“åº”
   {"status":"OK","timestamp":"...","version":"1.0.0"}
   ```

3. **é…ç½®è¯´æ˜**
   - è¯¦ç»†éƒ¨ç½²æŒ‡å—ï¼š[backend/DEPLOYMENT.md](backend/DEPLOYMENT.md)
   - APIæ–‡æ¡£ï¼š[backend/README.md](backend/README.md)

## APIæ¥å£è¯´æ˜

### è®¤è¯æ¥å£

#### code2session
```javascript
POST /api/auth/code2session
{
  "code": "ç™»å½•ä¸´æ—¶å‡­è¯"
}

// è¿”å›
{
  "success": true,
  "openid": "ç”¨æˆ·openid",
  "unionid": "ç”¨æˆ·unionid", 
  "session_key": "ä¼šè¯å¯†é’¥"
}
```

#### è·å–access_token
```javascript
POST /api/auth/get-access-token
{
  "ticket": "OAuthæˆæƒç¥¨æ®",
  "openId": "ç”¨æˆ·openid"
}

// è¿”å›
{
  "success": true,
  "access_token": "è®¿é—®ä»¤ç‰Œ",
  "refresh_token": "åˆ·æ–°ä»¤ç‰Œ",
  "expires_in": 7200
}
```

#### è·å–ç”¨æˆ·æ•°æ®
```javascript
POST /api/douyin/user-videos
POST /api/douyin/user-comments  
POST /api/douyin/user-messages
```

## ğŸ”§ ç”Ÿäº§ç¯å¢ƒé…ç½®

### 1. æŠ–éŸ³å¼€æ”¾å¹³å°é…ç½®

1. **æ³¨å†Œå¼€å‘è€…è´¦å·**
   - è®¿é—® [æŠ–éŸ³å¼€æ”¾å¹³å°](https://developer.open-douyin.com/)
   - æ³¨å†Œä¼ä¸šå¼€å‘è€…è´¦å·

2. **åˆ›å»ºå°ç¨‹åºåº”ç”¨**
   - åˆ›å»ºå°ç¨‹åºé¡¹ç›®
   - è·å– `AppID` å’Œ `AppSecret`

3. **ç”³è¯·APIæƒé™**
   - `user_info` - ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
   - `video.list` - è§†é¢‘åˆ—è¡¨æƒé™
   - `comment.list` - è¯„è®ºåˆ—è¡¨æƒé™
   - `message.list` - ç§ä¿¡åˆ—è¡¨æƒé™

### 2. ç¯å¢ƒé…ç½®

1. **åç«¯é…ç½®**
   ```bash
   cd backend
   cp env.example .env
   # ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®AppIDå’ŒAppSecret
   ```

2. **å‰ç«¯é…ç½®**
   ```javascript
   // utils/login.js ä¸­çš„APIåœ°å€
   const BACKEND_API_BASE = 'https://your-backend-domain.com';
   ```

3. **åŸŸåé…ç½®**
   - åœ¨æŠ–éŸ³å¼€æ”¾å¹³å°é…ç½®æœåŠ¡å™¨åŸŸåç™½åå•
   - é…ç½®requeståˆæ³•åŸŸå

## æ•°æ®ç»“æ„

### è§†é¢‘æ•°æ®
```javascript
{
  "item_id": "è§†é¢‘ID",
  "title": "è§†é¢‘æ ‡é¢˜",
  "cover": "å°é¢å›¾ç‰‡URL",
  "duration": 60,
  "create_time": 1640995200000,
  "statistics": {
    "play_count": 10000,
    "digg_count": 500,
    "comment_count": 100,
    "share_count": 50
  }
}
```

### è¯„è®ºæ•°æ®
```javascript
{
  "comment_id": "è¯„è®ºID",
  "text": "è¯„è®ºå†…å®¹",
  "create_time": 1640995200000,
  "digg_count": 10,
  "reply_count": 2,
  "item_id": "è§†é¢‘ID",
  "item_title": "è§†é¢‘æ ‡é¢˜"
}
```

### ç§ä¿¡æ•°æ®
```javascript
{
  "message_id": "æ¶ˆæ¯ID",
  "content": "æ¶ˆæ¯å†…å®¹",
  "create_time": 1640995200000,
  "from_user": {
    "open_id": "å‘é€è€…ID",
    "nickname": "å‘é€è€…æ˜µç§°",
    "avatar": "å¤´åƒURL"
  }
}
```

## å¼€å‘è°ƒè¯•

### 1. æ¨¡æ‹Ÿç¯å¢ƒ
å½“å‰ç‰ˆæœ¬åœ¨å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼ŒåŒ…æ‹¬ï¼š
- æ¨¡æ‹Ÿç™»å½•æµç¨‹
- æ¨¡æ‹ŸOAuthæˆæƒ
- æ¨¡æ‹ŸAPIå“åº”

### 2. çœŸå®ç¯å¢ƒåˆ‡æ¢
å½“åç«¯APIå‡†å¤‡å°±ç»ªåï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°çœŸå®APIè°ƒç”¨ã€‚

## ğŸ“š ç›¸å…³æ–‡æ¡£

- ğŸ“– [åç«¯APIæ–‡æ¡£](backend/README.md) - å®Œæ•´çš„APIæ¥å£è¯´æ˜
- ğŸš€ [éƒ¨ç½²æŒ‡å—](backend/DEPLOYMENT.md) - ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ•™ç¨‹
- ğŸ”— [æŠ–éŸ³å¼€æ”¾å¹³å°](https://developer.open-douyin.com/docs) - å®˜æ–¹æ–‡æ¡£

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æƒé™ç”³è¯·**ï¼šæŸäº›APIæƒé™éœ€è¦æŠ–éŸ³å®˜æ–¹å®¡æ ¸
2. **é¢‘ç‡é™åˆ¶**ï¼šæ³¨æ„APIè°ƒç”¨é¢‘ç‡é™åˆ¶
3. **å®‰å…¨é…ç½®**ï¼šç”Ÿäº§ç¯å¢ƒè¯·ä¿®æ”¹æ‰€æœ‰é»˜è®¤å¯†é’¥
4. **åŸŸåé…ç½®**ï¼šç¡®ä¿åœ¨æŠ–éŸ³å¼€æ”¾å¹³å°é…ç½®æ­£ç¡®çš„åŸŸåç™½åå•

## ğŸ¤ æŠ€æœ¯æ”¯æŒ

- ğŸ“§ **é—®é¢˜åé¦ˆ**ï¼šé¡¹ç›®Issues
- ğŸ“– **æŠ€æœ¯æ–‡æ¡£**ï¼šé¡¹ç›®READMEå’Œç›¸å…³æ–‡æ¡£
- ğŸŒ **å®˜æ–¹èµ„æº**ï¼šæŠ–éŸ³å¼€æ”¾å¹³å°å¼€å‘è€…ç¤¾åŒº

---

**âœ¨ æ­¤é¡¹ç›®æä¾›äº†æŠ–éŸ³å°ç¨‹åºæ•°æ®è·å–çš„å®Œæ•´ç”Ÿäº§çº§è§£å†³æ–¹æ¡ˆï¼ŒåŒ…å«å‰åç«¯å®Œæ•´å®ç°ï¼Œå¯ç›´æ¥ç”¨äºå®é™…é¡¹ç›®å¼€å‘ã€‚** 